<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Means++ 算法可视化 (三栏布局版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { touch-action: none; max-width: 100%; height: auto; }
        
        /* Code Syntax Highlighting */
        .code-container { 
            /* Background is handled by the sidebar container now */
            color: #d4d4d4; 
            font-family: 'Consolas', 'Monaco', monospace; 
            font-size: 0.85rem; 
            line-height: 1.6; 
        }
        .code-line { padding: 0 0.25rem; display: block; border-left: 3px solid transparent; }
        .code-line.active { background-color: #37373d; border-left-color: #3b82f6; }
        
        .kwd { color: #569cd6; } 
        .func { color: #dcdcaa; } 
        .var { color: #9cdcfe; } 
        .num { color: #b5cea8; } 
        .str { color: #ce9178; } 
        .comment { color: #6a9955; font-style: italic; }

        /* Custom Scrollbar for code/dark theme */
        .dark-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .dark-scrollbar::-webkit-scrollbar-track { background: #1e1e1e; }
        .dark-scrollbar::-webkit-scrollbar-thumb { background: #424242; border-radius: 4px; }
        .dark-scrollbar::-webkit-scrollbar-thumb:hover { background: #4f4f4f; }

        /* Custom Scrollbar for light theme */
        .light-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .light-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .light-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .light-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 h-14 flex items-center justify-between px-4 flex-shrink-0 z-20 shadow-sm relative">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 text-white p-1.5 rounded-md shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                </svg>
            </div>
            <div>
                <h1 class="text-base font-bold text-gray-800 tracking-tight">K-Means++ 原理可视化</h1>
            </div>
        </div>
        <div class="text-xs font-semibold text-blue-700 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">
            目标簇数 k = <span id="k-target">4</span>
        </div>
    </header>

    <!-- Main Layout: Left-Middle-Right -->
    <div class="flex-1 flex flex-col lg:flex-row overflow-hidden relative">
        
        <!-- 1. LEFT PANEL: CODE (Dark Theme) -->
        <aside class="w-full lg:w-[320px] bg-[#1e1e1e] border-r border-gray-700 flex flex-col z-10 flex-shrink-0 order-3 lg:order-1 h-1/3 lg:h-auto">
            <!-- Code Header -->
            <div class="h-9 border-b border-[#2d2d2d] bg-[#252526] flex items-center justify-between px-4 flex-shrink-0">
                <span class="text-[11px] font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2">
                    <svg class="w-3 h-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    KMEANS_PLUS_PLUS.PY
                </span>
            </div>
            <!-- Code Content -->
            <div class="flex-1 overflow-y-auto dark-scrollbar p-2 code-container" id="code-display">
                <!-- Code injected via JS -->
            </div>
        </aside>

        <!-- 2. MIDDLE PANEL: CANVAS (Visualization) -->
        <main class="flex-1 bg-gray-50 flex items-center justify-center p-4 overflow-auto relative order-1 lg:order-2 h-1/3 lg:h-auto">
            <div class="relative shadow-lg rounded-lg border border-gray-200 bg-white">
                <canvas id="canvas" width="600" height="500" class="block rounded-lg cursor-crosshair"></canvas>
                
                <!-- Floating Legend -->
                <div class="absolute bottom-3 left-3 bg-white/95 backdrop-blur-sm p-3 rounded border border-gray-200 text-xs shadow-md pointer-events-none">
                    <div class="font-bold text-gray-500 mb-2 uppercase tracking-wide text-[10px]">图例说明</div>
                    <div class="flex items-center gap-2 mb-1.5">
                        <span class="w-3 h-3 text-center leading-3 text-red-600 font-bold">★</span>
                        <span class="text-gray-700">已选中心</span>
                    </div>
                    <div class="flex items-center gap-2 mb-1.5">
                        <span class="w-3 h-3 rounded-full bg-blue-100 border border-blue-400 block"></span>
                        <span class="text-gray-700">被选概率 (面积 ∝ D<sup>2</sup>)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-6 h-px bg-gray-300 block"></span>
                        <span class="text-gray-400">最近中心连线</span>
                    </div>
                </div>
                
                <div class="absolute top-2 right-2 text-[10px] text-gray-300 font-mono">600x500</div>
            </div>
        </main>

        <!-- 3. RIGHT PANEL: CONTROLS (Light Theme) -->
        <aside class="w-full lg:w-[320px] bg-white border-l border-gray-200 flex flex-col shadow-[-2px_0_10px_rgba(0,0,0,0.02)] z-10 flex-shrink-0 order-2 lg:order-3 h-1/3 lg:h-auto">
            
            <div class="flex-1 overflow-y-auto light-scrollbar p-5 space-y-5">
                
                <!-- Status Card -->
                <div class="relative pl-3">
                    <div class="absolute left-0 top-1 bottom-1 w-1 bg-blue-500 rounded-full transition-colors duration-300" id="status-bar"></div>
                    
                    <div class="flex items-center gap-2 mb-1">
                        <span id="step-number" class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide">Step 0</span>
                        <h2 id="step-title" class="text-base font-bold text-gray-800">准备就绪</h2>
                    </div>
                    <p id="step-desc" class="text-sm text-gray-600 leading-relaxed">
                        点击下方按钮开始演示。
                    </p>

                    <!-- Dynamic Insight Box -->
                    <div id="insight-box" class="hidden mt-3 bg-amber-50 border border-amber-100 rounded-md p-3 text-sm text-amber-900">
                        <div class="flex items-center gap-1.5 mb-1 text-amber-700 font-bold text-[11px] uppercase tracking-wide">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            核心原理
                        </div>
                        <span id="insight-text" class="leading-relaxed block opacity-90">...</span>
                    </div>
                </div>

                <hr class="border-gray-100">

                <!-- Metrics -->
                <div>
                    <h3 class="text-[11px] font-bold text-gray-400 uppercase tracking-wider mb-2">实时指标</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-gray-50 p-2.5 rounded border border-gray-100">
                            <div class="text-[10px] text-gray-400 mb-0.5">当前中心数</div>
                            <div class="text-lg font-bold text-gray-800 font-mono"><span id="center-count">0</span><span class="text-gray-400 text-sm font-normal mx-1">/</span>4</div>
                        </div>
                        <div class="bg-gray-50 p-2.5 rounded border border-gray-100">
                            <div class="text-[10px] text-gray-400 mb-0.5">距离平方和 (Total)</div>
                            <div class="text-lg font-bold text-gray-800 font-mono" id="total-dist">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Buttons -->
            <div class="p-4 border-t border-gray-100 bg-gray-50/50 flex-shrink-0 grid grid-cols-3 gap-2">
                <button id="btn-reset" class="col-span-1 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-600 rounded-md transition font-medium text-sm shadow-sm flex items-center justify-center gap-1.5">
                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    重置
                </button>
                <button id="btn-next" class="col-span-2 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-sm hover:shadow-md transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span>开始演示</span> 
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                </button>
            </div>
        </aside>

    </div>

    <script>
        // Configuration
        const POINT_COUNT = 50;
        const TARGET_K = 4;
        const CANVAS_WIDTH = 600;
        const CANVAS_HEIGHT = 500;

        // State
        let points = [];
        let centers = []; // Array of indices
        let distances = []; // Array of {val, nearest}
        let step = 0; // 0:Init, 1:Pick First, 2:Calc Weights, 3:Roulette Select, 4:Done
        
        // DOM Elements
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        const btnReset = document.getElementById('btn-reset');
        const btnNext = document.getElementById('btn-next');
        
        const elStepNum = document.getElementById('step-number');
        const elTitle = document.getElementById('step-title');
        const elDesc = document.getElementById('step-desc');
        const elInsightBox = document.getElementById('insight-box');
        const elInsightText = document.getElementById('insight-text');
        const elCodeDisplay = document.getElementById('code-display');
        const elStatusBar = document.getElementById('status-bar');
        
        const elCount = document.getElementById('center-count');
        const elTotalDist = document.getElementById('total-dist');

        // Helper: Random Point
        function getRandomPoint() {
            return {
                x: Math.random() * (CANVAS_WIDTH - 80) + 40,
                y: Math.random() * (CANVAS_HEIGHT - 80) + 40
            };
        }

        // Helper: Euclidean Distance Squared
        function distSq(p1, p2) {
            return Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2);
        }

        // Code Snippet Generator
        function renderCode(activeStep) {
            const codeSnippets = {
                init: [
                    { t: 'comment', val: '# 1. 随机选择第一个中心' },
                    { t: 'line', content: [
                        {t:'var', v:'centers'}, {t:'plain', v:' = ['}, {t:'var', v:'random'}, {t:'plain', v:'.'}, {t:'func', v:'choice'}, {t:'plain', v:'('}, {t:'var', v:'vectors'}, {t:'plain', v:') ]'}
                    ]}
                ],
                calc: [
                    { t: 'comment', val: '# 2. 计算每个点到最近中心的距离平方 (权重)' },
                    { t: 'comment', val: '# 关键: 已选中心的距离会自动算为 0' },
                    { t: 'line', content: [
                        {t:'var', v:'dists'}, {t:'plain', v:' = ['}, {t:'func', v:'min'}, {t:'plain', v:'('}, {t:'func', v:'l2_dist'}, {t:'plain', v:'(v, c)'}, {t:'plain', v:'**'}, {t:'num', v:'2'}, 
                        {t:'plain', v:' '}, {t:'kwd', v:'for'}, {t:'plain', v:' c '}, {t:'kwd', v:'in'}, {t:'plain', v:' centers)'}
                    ]},
                    { t: 'line', indent: 1, content: [
                         {t:'kwd', v:'for'}, {t:'plain', v:' v '}, {t:'kwd', v:'in'}, {t:'plain', v:' vectors ]'}
                    ]}
                ],
                select: [
                    { t: 'comment', val: '# 3. 轮盘赌: 累积权重选择新中心' },
                    { t: 'line', content: [
                        {t:'var', v:'r'}, {t:'plain', v:' = '}, {t:'var', v:'random'}, {t:'plain', v:'.'}, {t:'func', v:'random'}, {t:'plain', v:'() * '}, {t:'func', v:'sum'}, {t:'plain', v:'(dists)'}
                    ]},
                    { t: 'line', content: [
                         {t:'var', v:'prefix'}, {t:'plain', v:' = '}, {t:'num', v:'0.0'}
                    ]},
                    { t: 'line', content: [
                        {t:'kwd', v:'for'}, {t:'plain', v:' v, d '}, {t:'kwd', v:'in'}, {t:'plain', v:' '}, {t:'func', v:'zip'}, {t:'plain', v:'(vectors, dists):'}
                    ]},
                    { t: 'line', indent: 1, content: [
                        {t:'var', v:'prefix'}, {t:'plain', v:' += d'}
                    ]},
                    { t: 'line', indent: 1, content: [
                        {t:'kwd', v:'if'}, {t:'plain', v:' prefix >= r:'}
                    ]},
                    { t: 'line', indent: 2, content: [
                        {t:'var', v:'centers'}, {t:'plain', v:'.'}, {t:'func', v:'append'}, {t:'plain', v:'(v)'}
                    ]},
                    { t: 'line', indent: 2, content: [
                        {t:'kwd', v:'break'}
                    ]}
                ]
            };

            let html = '';
            
            const buildLine = (lineObj, isActive) => {
                let inner = '';
                if (lineObj.t === 'comment') {
                    inner = `<span class="comment">${lineObj.val}</span>`;
                } else if (lineObj.content) {
                    inner = lineObj.content.map(part => {
                        return `<span class="${part.t}">${part.v}</span>`;
                    }).join('');
                }
                
                const indent = lineObj.indent ? `style="padding-left: ${lineObj.indent * 1.5}rem"` : '';
                const activeClass = isActive ? 'active' : '';
                return `<div class="code-line ${activeClass}" ${indent}>${inner}</div>`;
            };

            const isInitActive = (activeStep === 0 || activeStep === 1);
            html += `<div class="mb-3 ${!isInitActive ? 'opacity-30 blur-[1px] transition-all' : 'opacity-100'}">`;
            codeSnippets.init.forEach(l => html += buildLine(l, activeStep === 1)); 
            html += `</div>`;

            html += `<div class="border-l-2 border-gray-600 pl-3 mb-3 ml-1">`;
            html += `<div class="text-[10px] text-gray-500 mb-1 font-mono">// while len(centers) < k:</div>`;
            
            const isCalcActive = (activeStep === 2);
            html += `<div class="mb-3 ${!isCalcActive ? 'opacity-30 blur-[1px] transition-all' : 'opacity-100'}">`;
            codeSnippets.calc.forEach(l => html += buildLine(l, isCalcActive));
            html += `</div>`;

            const isSelectActive = (activeStep === 3);
            html += `<div class="${!isSelectActive ? 'opacity-30 blur-[1px] transition-all' : 'opacity-100'}">`;
            codeSnippets.select.forEach(l => html += buildLine(l, isSelectActive));
            html += `</div>`;

            html += `</div>`; 

            elCodeDisplay.innerHTML = html;
            
            // Auto scroll to active element
            setTimeout(() => {
                const activeEl = elCodeDisplay.querySelector('.active');
                if (activeEl) {
                    activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }


        // Initialization
        function init() {
            points = [];
            centers = [];
            distances = new Array(POINT_COUNT).fill({ val: Infinity, nearest: -1 });
            
            for (let i = 0; i < POINT_COUNT; i++) {
                points.push(getRandomPoint());
            }

            step = 0;
            updateUI();
            draw();
        }

        // Logic: Update Distances
        function calculateDistances() {
            if (centers.length === 0) return { totalSq: 0, maxDistSq: 0 };

            let totalSq = 0;
            let maxDistSq = 0;

            for (let i = 0; i < points.length; i++) {
                if (centers.includes(i)) {
                    distances[i] = { val: 0, nearest: i };
                    continue;
                }

                let d = Infinity;
                let nearestCenterIndex = -1;

                for (let j = 0; j < centers.length; j++) {
                    const centerIdx = centers[j];
                    const dTemp = distSq(points[i], points[centerIdx]);
                    if (dTemp < d) {
                        d = dTemp;
                        nearestCenterIndex = centerIdx;
                    }
                }
                distances[i] = { val: d, nearest: nearestCenterIndex };
                totalSq += d;
                if (d > maxDistSq) maxDistSq = d;
            }
            return { totalSq, maxDistSq };
        }

        // Step Logic
        function nextStep() {
            if (step === 4) return;

            // Step 0 -> 1: Pick First
            if (step === 0) {
                const firstIdx = Math.floor(Math.random() * points.length);
                centers.push(firstIdx);
                calculateDistances();
                step = 2; 
            }
            // Step 2 -> 3: Show Calc -> Show Select
            else if (step === 2) {
                step = 3;
            }
            // Step 3 -> 2 or 4: Select
            else if (step === 3) {
                const { totalSq } = calculateDistances();
                let r = Math.random() * totalSq;
                let prefix = 0;
                let selectedIdx = -1;
                
                for (let i = 0; i < points.length; i++) {
                    if (centers.includes(i)) continue;
                    prefix += distances[i].val;
                    if (prefix >= r) {
                        selectedIdx = i;
                        break;
                    }
                }
                
                if (selectedIdx === -1) {
                    let maxD = -1;
                    points.forEach((p, i) => {
                         if (!centers.includes(i) && distances[i].val > maxD) {
                             maxD = distances[i].val;
                             selectedIdx = i;
                         }
                    });
                }

                centers.push(selectedIdx);
                calculateDistances();

                if (centers.length >= TARGET_K) {
                    step = 4;
                } else {
                    step = 2;
                }
            }
            
            updateUI();
            draw();
        }

        // Drawing
        function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function draw() {
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            const { totalSq, maxDistSq } = calculateDistances();

            // Connections
            if (centers.length > 0) {
                points.forEach((p, i) => {
                    if (centers.includes(i)) return;
                    const nearestIdx = distances[i]?.nearest;
                    if (nearestIdx !== undefined && nearestIdx !== -1) {
                        const c = points[nearestIdx];
                        ctx.beginPath();
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(c.x, c.y);
                        ctx.strokeStyle = '#cbd5e1'; // Slate 300
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                });
            }

            // Points
            points.forEach((p, i) => {
                const isCenter = centers.includes(i);
                
                if (step === 3 && !isCenter) {
                    const d = distances[i]?.val || 0;
                    const visualRadius = (d / maxDistSq) * 35 + 4; 
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, visualRadius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(59, 130, 246, 0.1)'; 
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
                    ctx.stroke();
                }

                if (isCenter) {
                    ctx.fillStyle = '#dc2626';
                    ctx.strokeStyle = '#7f1d1d';
                    ctx.lineWidth = 2;
                    drawStar(ctx, p.x, p.y, 5, 12, 6); 
                    
                    const order = centers.indexOf(i) + 1;
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(order, p.x, p.y + 1);

                } else {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#64748b';
                    ctx.fill();
                }
            });
        }

        function updateUI() {
            const { totalSq } = calculateDistances();
            
            elCount.textContent = centers.length;
            elTotalDist.textContent = Math.round(totalSq).toLocaleString();
            
            elInsightBox.classList.add('hidden');
            renderCode(step); // Update code highlighting

            // Colors for steps
            let stepColor = "blue"; 
            if (step === 3) stepColor = "amber";
            if (step === 4) stepColor = "green";
            if (step === 0) stepColor = "gray";

            elStatusBar.className = `absolute left-0 top-1 bottom-1 w-1 rounded-full transition-colors duration-300 bg-${stepColor}-500`;
            elStepNum.className = `bg-${stepColor}-100 text-${stepColor}-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide`;

            switch(step) {
                case 0:
                    elStepNum.textContent = "Step 0";
                    elTitle.textContent = "数据初始化";
                    elDesc.innerHTML = `已随机生成 ${POINT_COUNT} 个样本点。根据代码逻辑，我们需要先随机选择第 1 个中心。`;
                    btnNext.innerHTML = `<span>随机选第1个点</span> <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>`;
                    btnNext.disabled = false;
                    break;

                case 2: // Calculation
                    elStepNum.textContent = `Step ${centers.length} (计算)`;
                    elTitle.textContent = "计算距离权重";
                    elDesc.innerHTML = `
                        对于每个点，计算它到<strong>最近</strong>中心的距离平方 D<sup>2</sup>。
                        这对应代码中的列表推导式 <code>dists = [...]</code>。
                    `;
                    elInsightBox.classList.remove('hidden');
                    elInsightText.innerHTML = `已选红点的距离为 0 (不会重复被选)。`;
                    btnNext.innerHTML = `<span>执行计算</span> <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>`;
                    break;

                case 3: // Selection
                    elStepNum.textContent = `Step ${centers.length} (选择)`;
                    elTitle.textContent = "轮盘赌选择";
                    elDesc.innerHTML = `
                        根据 D<sup>2</sup> 权重进行概率选择。
                        蓝色光环越大 = D<sup>2</sup> 越大 = <code>prefix</code> 累积越快 = 越容易被选中。
                    `;
                    elInsightBox.classList.remove('hidden');
                    elInsightText.innerHTML = `对应代码中的 <code>if prefix >= r</code> 判断。`;
                    btnNext.innerHTML = `<span>执行筛选</span> <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                    break;

                case 4: // Done
                    elStepNum.textContent = "完成";
                    elTitle.textContent = "初始化结束";
                    elDesc.innerHTML = `
                        已选出 ${TARGET_K} 个初始中心点。循环结束。
                    `;
                    btnNext.innerHTML = `<span>已完成</span> <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                    btnNext.disabled = true;
                    break;
            }
        }

        btnReset.addEventListener('click', init);
        btnNext.addEventListener('click', nextStep);

        init();

    </script>
</body>
</html>